using System.Diagnostics;
using UnityEngine;

public class APIAutoStarterFast : MonoBehaviour
{
    private Process apiProcess;
    public bool apiReady = false;
    private float startTime;

    void Start()
    {
        UnityEngine.Debug.Log("ðŸŽ® INICIANDO API RÃPIDO (5s)...");
        startTime = Time.time;
        StartAPIFast();
    }

    void Update()
    {
        float tempoDecorrido = Time.time - startTime;

        if (!apiReady && tempoDecorrido > 5f)
        {
            apiReady = true;
            UnityEngine.Debug.Log("âœ… API PRONTA EM " + tempoDecorrido.ToString("F1") + " SEGUNDOS!");
        }

        // Feedback a cada segundo
        if (!apiReady && tempoDecorrido < 5f)
        {
            if (tempoDecorrido > 1f && tempoDecorrido < 1.1f) UnityEngine.Debug.Log("â³ 1 segundo...");
            else if (tempoDecorrido > 2f && tempoDecorrido < 2.1f) UnityEngine.Debug.Log("â³ 2 segundos...");
            else if (tempoDecorrido > 3f && tempoDecorrido < 3.1f) UnityEngine.Debug.Log("â³ 3 segundos...");
            else if (tempoDecorrido > 4f && tempoDecorrido < 4.1f) UnityEngine.Debug.Log("â³ 4 segundos...");
        }
    }

    void StartAPIFast()
    {
        try
        {
            string projectPath = @"C:\Users\00119012.UNISOACAD\source\repos\WebPlayerAPI";

            // Usa cmd para iniciar mais rÃ¡pido
            ProcessStartInfo startInfo = new ProcessStartInfo();
            startInfo.FileName = "cmd.exe";
            startInfo.Arguments = $"/C dotnet run --no-build --verbosity quiet";
            startInfo.WorkingDirectory = projectPath;
            startInfo.WindowStyle = ProcessWindowStyle.Hidden;
            startInfo.CreateNoWindow = true;
            startInfo.UseShellExecute = false;

            apiProcess = Process.Start(startInfo);
            UnityEngine.Debug.Log("ðŸš€ API INICIADA (modo rÃ¡pido)");
        }
        catch (System.Exception ex)
        {
            UnityEngine.Debug.LogError("âŒ Erro: " + ex.Message);
        }
    }

    void OnApplicationQuit()
    {
        if (apiProcess != null && !apiProcess.HasExited)
        {
            apiProcess.Kill();
            UnityEngine.Debug.Log("ðŸ›‘ API parada");
        }
    }

    public bool IsAPIReady()
    {
        return apiReady;
    }
}
